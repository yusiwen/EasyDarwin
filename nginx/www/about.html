<!DOCTYPE html>
<html>

<head>
		<title>EasyDarwin</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" href="./adminlte-2.3.6/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/font-awesome-4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/ionicons-2.0.1/css/ionicons.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/dist/css/AdminLTE.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/dist/css/skins/skin-green.min.css">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

	<script src="./adminlte-2.3.6/plugins/jQuery/jquery-2.2.3.min.js"></script>
	<script src="./adminlte-2.3.6/bootstrap/js/bootstrap.min.js"></script>
	<script src="./adminlte-2.3.6/dist/js/app.js"></script>
	<script src="./adminlte-2.3.6/plugins/slimScroll/jquery.slimscroll.min.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/iCheck/all.css">
	<script src="./adminlte-2.3.6/plugins/iCheck/icheck.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/md5/jquery.md5.js"></script>
	<script src="./adminlte-2.3.6/plugins/input-number/jquery.inputnumber.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/gritter/jquery.gritter.css">
	<script src="./adminlte-2.3.6/plugins/gritter/jquery.gritter.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/loadmask/jquery.loadmask.css">
	<script src="./adminlte-2.3.6/plugins/loadmask/jquery.loadmask.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/validator/validator.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/bootbox/bootbox.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/cookie/jquery.cookie.min.js"></script>
	<script src="./easyui/easyloader.js"></script>

	<link rel="stylesheet" href="./css/common.css">
	<script src="./js/common.js"></script>
	<script src="./adminlte-2.3.6/plugins/nicescroll/jquery.nicescroll.min.js"></script>
</head>
<body class="hold-transition skin-green sidebar-mini hide">
	<script>
	    try {
	        $(document).on("transitionend", ".content-wrapper", function () {
	            localStorage["sidebar-collapse"] = $("body").hasClass("sidebar-collapse") ? "sidebar-collapse" : "";
	        });
	        $("body").addClass(localStorage["sidebar-collapse"]);
	    } catch (e) {
	    }
	</script>
	<div class="wrapper">

		<header class="main-header">

			<a href="#" class="logo">
				<!-- mini logo for sidebar mini 50x50 pixels -->
				<span class="logo-mini">ED</span>
				<!-- logo for regular state and mobile devices -->
				<span class="logo-lg">EasyDarwin</span>
			</a>

			<nav class="navbar navbar-static-top" role="navigation">
				<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
					<span class="sr-only">Toggle navigation</span>
				</a>
				<div class="navbar-custom-menu">
					<ul class="nav navbar-nav">
						<li>
	                        <a id="btn-modify-pwd" href="#" data-toggle="modal" data-target="#pwd-dlg"><i
	                                class="fa fa-key"></i> 修改密码</a>
	                    </li>
	                    <li>
	                        <a id="btn-logout" href="javascript:void(0);"><i class="fa fa-power-off"></i> 注 销</a>
	                    </li>
					</ul>
				</div>
			</nav>
		</header>
		<aside class="main-sidebar main-sidebar-gray">
			<section class="sidebar">
				<ul class="sidebar-menu">
					<li class="treeview">
						<a href="/">
							<i class="fa fa-video-camera"></i>
							<span>直播推流列表</span>
						</a>
					</li>
					<li class="treeview">
						<a href="/config.html">
							<i class="fa fa-cogs"></i>
							<span>基本配置</span>
						</a>
					</li>
					<li class="treeview">
						<a href="/about.html">
							<i class="fa fa-support"></i>
							<span>服务运行信息</span>
						</a>
					</li>
				</ul>
			</section>
		</aside>

	    <div class="modal fade" id="pwd-dlg">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">&times;</span>
	                    </button>
	                    <h4 class="modal-title">修改密码</h4>
	                </div>
	                <form id="pwd-form" class="form-horizontal" data-toggle="validator" data-disable="false">
	                    <div class="modal-body">
	                        <div class="form-group">
	                            <label for="input-old-pwd" class="col-sm-3 control-label">
	                                原密码
	                                <span class="text-red">*</span>
	                                :
	                            </label>
	                            <div class="col-sm-8">
	                                <input id="input-old-pwd" type="password" name="oldPwd" class="form-control" required>
	                                <span class="help-block with-errors"></span>
	                            </div>
	                        </div>
	                        <div class="form-group">
	                            <label for="input-new-pwd" class="col-sm-3 control-label">
	                                新密码
	                                <span class="text-red">*</span>
	                                :
	                            </label>
	                            <div class="col-sm-8">
	                                <input id="input-new-pwd" type="password" name="newPwd" class="form-control" required>
	                                <span class="help-block with-errors"></span>
	                            </div>
	                        </div>
	                        <div class="form-group">
	                            <label for="input-new-pwd2" class="col-sm-3 control-label">
	                                确认新密码
	                                <span class="text-red">*</span>
	                                :
	                            </label>
	                            <div class="col-sm-8">
	                                <input id="input-new-pwd2" type="password" name="newPwd2" class="form-control"
	                                       data-match="#input-new-pwd"
	                                       data-match-error="两次密码输入不一致" required>
	                                <span class="help-block with-errors"></span>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="modal-footer">
	                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	                        <button type="submit" class="btn btn-primary">确定</button>
	                    </div>
	                </form>
	            </div>
	        </div>
	    </div>

		<div class="content-wrapper">
			<section class="content-header">
				<ol class="breadcrumb">
					<li><a href="/"><i class="fa fa-dashboard"></i> 首页</a></li>
				</ol>
			</section>
			<section class="content">

<script>
	$(function(){
//var openurls = ["/","/about.html"];
	var token = $.cookie("token")||"";
	//if(!token && $.inArray(location.pathname,openurls) < 0){
	//	top.location.href = "/login.html";
	//}
	if(!token){
		$(".treeview [href=/config.html]").closest(".treeview").hide();
		$(".treeview [href=/channel.html]").closest(".treeview").hide();
	}
	$("#btn-logout").click(function(){
		$.get(_url + "/logout");
		$.cookie("token","",{expires : -1});
		$.cookie("username","",{expires : -1});
		top.location.href = "/login.html";
	})
	$("#reboot-btn").click(function(){
		var $this = $(this);
		bootbox.confirm({
			title : "提示",
			message : "确定要重启吗?",
			buttons : {
				confirm : {
					label : "确定",
					className : "btn-primary btn-sm",
				},
				cancel : {
					label : "取消",
					className : "btn-sm",
				}
			},
			callback : function(result) {
				if (result) {
					$this.prop("disabled",true);
					$.ajax({
						type : "GET",
						url : _url + "/restart",
						success : function(data){
							$.gritter.add({
								text : '重启中...',
								class_name : 'gritter-info'
							});
						},
						complete : function(xhr, ts){
							$this.prop("disabled",false);
						}
					})
				}
			}
		});										
		return false;
	})
	$('#pwd-form').validator().on('submit', function (e) {
		if (!e.isDefaultPrevented()) {
			e.preventDefault();
			var _oldPwd = $("#pwd-form [name=oldPwd]").val();
			var _newPwd = $("#pwd-form [name=newPwd]").val();
			if (!/^[a-zA-Z0-9]+$/.test(_newPwd) || _newPwd.length > 16) {
				$.gritter.add("密码长度不超过16字符，为英文或数字!");
				return false;
			}
			$("#pwd-form [type=submit]").prop("disabled",true);
			$.ajax({
				type : "GET",
				url : _url + "/modifypassword",
				data : {
					oldpassword : $.md5(_oldPwd),
					newpassword : $.md5(_newPwd)
				},
				global : false,
				success : function(data){
					try{
						console.log(data);
						var ret = JSON.parse(data);
						$.cookie("token",ret.EasyDarwin.Body.Token);
						$.gritter.add({
							text : "修改密码成功!",
							class_name : "gritter-info"
						});
						$("#pwd-dlg").modal("hide");
						return;
					}catch(e){}
					$.gritter.add("修改密码不成功!");
				},
				error : function(xhr,ts,err){
					$.gritter.add("修改密码不成功!");
				},
				complete : function(){
					$("#pwd-form [type=submit]").prop("disabled",false);
				}
			});
		}
	});	
	});
	
</script>
<script>
	$(".breadcrumb").append("<li class='active'><i class='fa fa-support'></i> 服务运行信息</li>");
</script>
<div class="container-fluid no-padding">
	<div class="col-lg-offset-2 col-lg-8 no-padding server-info">
		<div class="box box-widget">
			<div class="box-header">
				<h3> <i class="fa fa-support"></i> EasyDarwin服务运行信息</h3>
			</div>
			<div class="box-body table-responsive no-padding">
				<table class="table table-striped">
					<tr>
						<td>硬件信息</td>
						<td><span id="hardware-info"></span></td>
					</tr>
					<tr>
						<td>接口版本</td>
						<td><span id="interface-info"></span></td>
					</tr>
					<tr>
						<td>运行时间</td>
						<td><span id="running-time-info"></span></td>
					</tr>
					<tr>
						<td>软件信息</td>
						<td><span id="software-info"></span></td>
					</tr>
				</table>
			</div>
			<div class="box-footer"><button id="reboot-btn" class="label pull-right btn btn-sm btn-primary">
									<i class="fa fa-power-off text-orange"></i> 重启
								</button></div>
		</div>
	</div>
</div>
<script>
	$(function(){

		$(".server-info .box-body").niceScroll();
		try{
			$.get(_url + "/getserverinfo",function(data){
				var ret = JSON.parse(data);
				$.cookie("iv",ret.EasyDarwin.Body.InterfaceVersion||__iv,{expires : 365});
				$("#hardware-info").text(ret.EasyDarwin.Body.Hardware);
				$("#interface-info").text(ret.EasyDarwin.Body.InterfaceVersion);
				$("#running-time-info").text(ret.EasyDarwin.Body.RunningTime);
				$("#software-info").text(ret.EasyDarwin.Body.Server);
			})
		}catch(e){}

	})
</script>
</section>
</div>
<!-- content-wrapper -->

<footer class="main-footer">
	<div class="pull-right hidden-xs">
		EasyDarwin
	</div>
	<strong>Copyright &copy; 2016 <a href="#">www.easydarwin.org</a>.</strong> All rights reserved.
</footer>
</div>
<!-- wrapper-->
</body>

</html>