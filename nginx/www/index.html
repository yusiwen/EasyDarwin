<!DOCTYPE html>
<html>
	<head>
			<title>EasyDarwin</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" href="./adminlte-2.3.6/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/font-awesome-4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/ionicons-2.0.1/css/ionicons.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/dist/css/AdminLTE.min.css">
	<link rel="stylesheet" href="./adminlte-2.3.6/dist/css/skins/skin-green.min.css">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

	<script src="./adminlte-2.3.6/plugins/jQuery/jquery-2.2.3.min.js"></script>
	<script src="./adminlte-2.3.6/bootstrap/js/bootstrap.min.js"></script>
	<script src="./adminlte-2.3.6/dist/js/app.js"></script>
	<script src="./adminlte-2.3.6/plugins/slimScroll/jquery.slimscroll.min.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/iCheck/all.css">
	<script src="./adminlte-2.3.6/plugins/iCheck/icheck.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/md5/jquery.md5.js"></script>
	<script src="./adminlte-2.3.6/plugins/input-number/jquery.inputnumber.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/gritter/jquery.gritter.css">
	<script src="./adminlte-2.3.6/plugins/gritter/jquery.gritter.js"></script>
	<link rel="stylesheet" href="./adminlte-2.3.6/plugins/loadmask/jquery.loadmask.css">
	<script src="./adminlte-2.3.6/plugins/loadmask/jquery.loadmask.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/validator/validator.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/bootbox/bootbox.min.js"></script>
	<script src="./adminlte-2.3.6/plugins/cookie/jquery.cookie.min.js"></script>
	<script src="./easyui/easyloader.js"></script>

	<link rel="stylesheet" href="./css/common.css">
	<script src="./js/common.js"></script>
		<link rel="stylesheet" href="./css/login.css">
	</head>
	<body class="center light-login">
		<div class="row header-space">
		</div>
		<div class="login-container">
		    <div id="login-panel" class="panel panel-success visible">
		        <div class="panel-heading text-center">
		            <h3><b>EasyDarwin</b> - 登录</h3>
		        </div>
		        <div class="panel-body">
		            <br>
					<form id="login-form" data-toggle="validator" data-feedback="" data-disable="false" autocomplete="off">
		                <input name="password" type="hidden"/>
		                <div class="form-group has-feedback">
		                    <input id="login-username" type="text" class="form-control" placeholder="用户名" name="username" required>
		                    <span class="glyphicon glyphicon-user form-control-feedback text-gray"></span>
							<span class="help-block with-errors"></span>
		                </div>
		                <div class="form-group has-feedback">
		                    <input id="login-pwd" type="password" class="form-control" placeholder="密码" required>
		                    <span class="glyphicon glyphicon-lock form-control-feedback text-gray"></span>
							<span class="help-block with-errors"></span>
		                </div>
		                <div class="row">
		                    <!--<div class="col-xs-8">
		                        <input type="hidden" id="login-remember-me" name="rememberMe"/>
		                        <div class="checkbox icheck">
		                            <label>
		                                <input id="checkbox-login-remember-me" type="checkbox"> 保持登录
		                            </label>
		                        </div>
		                    </div>-->
		                    <div class="col-xs-offset-8 col-xs-4">
		                        <button id="btn-login" type="button" class="btn btn-primary btn-block btn-flat">登录</button>
		                    </div>
		                </div>
		            </form>
		        </div>

		        <div class="panel-footer">
		            <div class="row">
		                <div class="col-xs-6 text-left">
		                    <a href="#" class="" data-target="#forgot-panel">忘记密码</a>
		                </div>
		                <div class="col-xs-6 text-right">
		                        <!--<a href="#" class="" data-target="#regist-panel">注 册</a>-->
		                </div>
		            </div>
		        </div>
		    </div>

		    <div id="forgot-panel" class="panel panel-danger">
		        <div class="panel-heading">
		            <p class="panel-title text-left"><i class="fa fa-key"></i> 提示</p>
		        </div>
		        <div class="panel-body text-center">
		            <small>请联系运营人员重置您的密码。</small>
		        </div>

		        <div class="panel-footer text-center">
		            <a href="#" data-target="#login-panel">返回登录
		            </a>
		        </div>
		    </div>

		    <div id="regist-panel" class="panel panel-success">
		        <div class="panel-heading text-center">
		            <h3><b>EasyDarwin</b> - 注册</h3>
		        </div>
		        <div class="panel-body">
		            <br>
		            <form id="regist-form" data-toggle="validator" data-feedback="" data-disable="false">
		                <div class="form-group has-feedback">
		                    <input id="regist-username" type="text" class="form-control" placeholder="用户名" name="username" required>
		                    <span class="glyphicon glyphicon-user form-control-feedback text-gray"></span>
							<span class="help-block with-errors"></span>
		                </div>
		                <div class="form-group has-feedback">
		                    <input id="regist-pwd" type="password" class="form-control" placeholder="密码" required>
		                    <span class="glyphicon glyphicon-lock form-control-feedback text-gray"></span>
							<span class="help-block with-errors"></span>
		                </div>
		                <div class="form-group has-feedback">
		                    <input id="regist-pwd2" type="password" class="form-control" placeholder="确认密码"
							data-match="#regist-pwd" data-match-error="两次密码输入不一致" required>
		                    <span class="glyphicon glyphicon-retweet form-control-feedback text-gray"></span>
							<span class="help-block with-errors"></span>
		                </div>
		                <div class="row">
		                    <div class="col-xs-4">
		                        <button type="reset" class="btn btn-default btn-block btn-flat">重 置</button>
		                    </div>
		                    <div class="col-xs-4">
		                    </div>
		                    <div class="col-xs-4">
		                        <button id="btn-regist" type="submit" class="btn btn-primary btn-block btn-flat">注 册</button>
		                    </div>
		                </div>
		            </form>
		        </div>
		        <div class="panel-footer text-center">
		            <a href="#" data-target="#login-panel">返回登录
		            </a>
		        </div>
		    </div>

		</div>

		<script>
		    $(function () {
		        // $("#checkbox-login-remember-me").on("ifChecked", function() {
		        //     $("#login-remember-me").val('yes');
		        // }).on("ifUnchecked",function () {
		        //     $("#login-remember-me").val('no');
		        // }).iCheck($("#login-remember-me").val() == 'yes' ? 'check' : 'uncheck');

		        $(document).on('click', '.panel-footer a[data-target]', function (e) {
		            e.preventDefault();
		            var target = $(this).data('target');
		            $('.panel.visible').removeClass('visible');
		            $(target).addClass('visible');
		        });

		        $("#login-username").on('keyup',function(e){
		            if(e.keyCode == 13){
		                $("#login-pwd").focus().select();
		                return false;
		            }
		        });

		        $("#login-pwd").on("keyup", function(e) {
		            if (e.keyCode == 13) {
		                $("#login-panel form").submit();
		                return false;
		            }
		        });

		        $("#btn-login").click(function(){
		            $("#login-panel form").submit();
		        });
				$('#login-form').validator().on('submit', function (e) {
					if (!e.isDefaultPrevented()) {
						e.preventDefault();
						var pwd = $("#login-pwd").val();
						var password = $.md5(pwd);
						$("input[name=password]").val(password);
						var username = $("#login-username").val();
						$("#btn-login").prop("disabled",true);
						var ajaxTimeoutTest = $.ajax({
							type : "GET",
							url : _url + "/login",
							timeout:3000,
							async:true,
							data : {
								username : username,
								password : password
							},
							global : false,
							success : function(data){
								try{
									var ret = JSON.parse(data);
									var token = ret.EasyDarwin.Body.Token;
									$.cookie("token",token);
									$.cookie("username",username);
									top.location.href = "main.html";
								}catch(e){
									console.log(e);
								}
							},
							error : function(xhr,ts,err){
								$.gritter.add({
									text : '用户名或密码错误!',
									class_name : 'gritter-error'
								})
							},
							  
							complete : function(XMLHttpRequest,status){
								if(status=='timeout'){//超时,status还有success,error等值的情况
 　　　　　 							ajaxTimeoutTest.abort();
　　　　　  							$.gritter.add("您好！请启动EasyDarwin流媒体服务！");
　　　　						 }
								$("#btn-login").prop("disabled",false);
							}
						});
					}
				})

		        $("#regist-username").on("keyup",function (e) {
		            if(e.keyCode == 13){
		                $("#regist-pwd").focus().select();
		                return false;
		            }
		        })

		        $("#regist-pwd").on("keyup",function (e) {
		            if(e.keyCode == 13){
		                $("#regist-pwd2").focus().select();
		                return false;
		            }
		        });

		        $("#regist-pwd2").on("keyup",function (e) {
		            if(e.keyCode == 13){
		                $("#btn-regist").trigger("click");
		                return false;
		            }
		        });

				$('#regist-form').validator().on('submit', function (e) {
					if (!e.isDefaultPrevented()) {
						e.preventDefault();
						var username = $("#regist-username").val();
						var password = $("#regist-pwd").val();
						$.ajax({
							url : '/regist',
							method : 'POST',
							type : 'json',
							data : {
								username : username,
								password : $.md5(password)
							},
							success : function() {
								$.gritter.add({
									text : '注册成功!',
									class_name : 'gritter-success'
								});
								$("#regist-panel button[type=reset]").trigger("click");
							}
						});
					}
				}).on('reset',function(e){
		            $("#regist-username").focus();
					setTimeout(function(){
						$("#regist-form").find(".form-group").removeClass("has-error").removeClass("has-success");
						$("#regist-form").find(".with-errors").empty();
					},500);
				})

		    });
		</script>
	</body>
</html>